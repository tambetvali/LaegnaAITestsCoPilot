# The Long and Boring Manual for the Laegna AI Forum System

This document explains, in excruciating detail, how the AI Forum system is structured, how its Python code is organized, how its APIs are shaped, how its filesystem is laid out, and how the Q&A tree behaves.  
It is intentionally slow, repetitive, and explicit, so that even users who only vaguely understand Python can follow along.

The manual is divided into chapters.  
Each chapter ends with a **Task Block**, which is a code block containing a description of what code should be written for that chapter.  
These tasks can be given to Copilot or any AI coding assistant to generate the implementation.

---

# Chapter 1 — Understanding the Purpose of the System

The AI Forum is a web application that allows users to create **Q&A nodes**.  
Each node contains:

- A **question** written in Markdown (via a WYSIWYG editor).
- An **answer** generated by an AI model.
- A **parent** pointer (optional).
- A **previous** pointer (optional).
- A **snapshot of extension state** (optional).

The system supports two access patterns:

1. **Linear access**  
   Q&As are ordered by the time they were created.  
   The AI processes unanswered questions in order.  
   This is similar to a queue: first unanswered, first processed.

2. **Treelike access**  
   Each Q&A may have:
   - A parent (the Q&A it replies to)
   - A previous sibling (the Q&A that came before it under the same parent)

   This forms a tree of Q&As, where each branch is a conversation thread.

The system is designed so that:

- The **root page** is a special Q&A that is invisible.  
- The **main article** (the user’s initial Markdown document) is stored as the first visible Q&A.  
- Any change to the main article is stored as a new Q&A that is a child of the invisible root.

This ensures that the entire history of the main article is preserved.

---

# Chapter 2 — Python Basics for People Who Work With AI

This chapter explains Python concepts in a gentle way.

## 2.1 Variables

A variable in Python is simply a name that refers to a value.  
For example:

\`\`\`
x = 10
\`\`\`

This means “the name `x` refers to the number 10.”

## 2.2 Dictionaries

A dictionary is a mapping from keys to values.  
Q&A nodes are stored as dictionaries:

\`\`\`
qa = {
    "id": 1,
    "question": "What is AI?",
    "answer": "AI is...",
    "parent_id": None,
    "previous_id": None
}
\`\`\`

## 2.3 Functions

A function is a reusable block of code:

\`\`\`
def add(a, b):
    return a + b
\`\`\`

## 2.4 Classes

A class defines a type of object.  
Extensions are implemented as classes.

\`\`\`
class MyExtension:
    def before_question(self, qa):
        pass
\`\`\`

---

# Chapter 3 — Filesystem Structure

The project directory might look like this:

\`\`\`
AIForum/
    app.py
    templates/
        index.html
    static/
        style.css
    data/
        qas.json
    extensions/
        base.py
        git_extension.py
        file_extension.py
\`\`\`

- `app.py` is the Flask server.
- `templates/` contains HTML templates.
- `static/` contains CSS and JS files.
- `data/` stores Q&A data.
- `extensions/` contains extension classes.

---

# Chapter 4 — API Structure

The system exposes internal APIs (not public APIs).  
These APIs are Python functions that the server uses to:

- Create Q&A nodes  
- Traverse Q&A trees  
- Build AI context  
- Load and save extension state  
- Interact with the filesystem  
- Interact with Git (if the Git extension is installed)

Each API is designed to be simple and predictable.

For example:

\`\`\`
create_qa(question, parent_id=None, previous_id=None)
\`\`\`

This function creates a new Q&A node.

---

# Chapter 5 — Flask Server Structure

Flask is a Python web framework.  
It allows you to define routes, which are URLs that run Python code.

For example:

\`\`\`
@app.route("/")
def index():
    return render_template("index.html")
\`\`\`

This means:

- When the user visits `/`, Flask calls the `index()` function.
- The function returns an HTML page.

Flask uses a template system called **Jinja2**.  
Templates allow you to write HTML with placeholders like:

\`\`\`
{{ qa.question }}
\`\`\`

This inserts the question text into the HTML.

---

# Chapter 6 — The Main Article as the Root Q&A

The main article is the first visible Q&A.  
It is stored as:

- `parent_id = invisible_root_id`
- `previous_id = None`

If the user edits the main article, the system creates a new Q&A:

- `parent_id = invisible_root_id`
- `previous_id = id_of_previous_main_article`

This creates a linear history of main article versions.

---

# Chapter 7 — Q&A Nested Loops

A Q&A node may have:

- A parent (the Q&A it replies to)
- A previous sibling (the Q&A that came before it)

This creates a nested loop structure:

- The **outer loop** is the parent chain.
- The **inner loop** is the previous chain.

To build context for a Q&A:

1. Walk up the parent chain.
2. For each parent, walk through its previous siblings.

This creates a complete conversation history.

---

# Chapter 8 — Tooling

The system includes tools for:

- Web interfacing (Fl://ask route that creates a new Q&A and triggers AI
    - template rendering with Jinja2
    - static file serving for CSS and JS

## Task 9.6 — Implement Main Article Behavior

    Implement logic so that:
    - the main article is stored as a Q&A
    - edits create new Q&As
    - the main article history is linear

## Task 9.7 — Implement Search Tool

    Implement search_qas(keyword) that returns Q&As containing the keyword.

## Task 9.8 — Implement Filesystem Browser

    Implement a tool that:
    - lists files in a directory
    - reads file contents
    - optionally writes files

---

# Chapter 10 — Final Copilot Task

Below is the final task that initializes the entire server.

## Task 10.1 — Initialize Full Server

    Create a complete Flask application that:
    - loads Q&A data from JSON
    - saves Q&A data after each change
    - supports Q&A creation with parent/previous logic
    - supports extension system with lifecycle hooks
    - supports Git extension
    - supports main article behavior
    - supports search
    - supports filesystem browsing
    - renders templates with Jinja2
    - serves static files
    - provides a WYSIWYG Markdown editor
    - displays Q&A tree and linear list
    - processes unanswered Q&As in linear order
    - builds AI context from parent/previous chains
    - calls AI connector to generate answers

---

# End of Manual

This concludes the long, boring, highly detailed manual for the Laegna AI Forum system.
